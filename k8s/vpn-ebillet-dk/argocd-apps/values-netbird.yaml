netbird:
  fullnameOverride: netbird
  management:
    configmap: |-
      {
        "Stuns": [
          {
            "Proto": "udp",
            "URI": "{{ .STUN_SERVER }}",
            "Username": "",
            "Password": ""
          }
        ],
        "TURNConfig": {
          "TimeBasedCredentials": false,
          "CredentialsTTL": "12h0m0s",
          "Secret": "secret",
          "Turns": [
            {
              "Proto": "udp",
              "URI": "{{ .TURN_SERVER }}",
              "Username": "{{ .TURN_SERVER_USER }}",
              "Password": "{{ .TURN_SERVER_PASSWORD }}"
            }
          ]
        },
        "Relay": {
          "Addresses": ["rels://vpn2.ebillet.dk:443/relay"],
          "CredentialsTTL": "24h",
          "Secret": "{{ .RELAY_PASSWORD }}"
        },
        "Signal": {
          "Proto": "https",
          "URI": "vpn2.ebillet.dk:443",
          "Username": "",
          "Password": ""
        },
        "Datadir": "/var/lib/netbird/",
        "DataStoreEncryptionKey": "{{ .DATASTORE_ENCRYPTION_KEY }}",
        "HttpConfig": {
          "LetsEncryptDomain": "",
          "CertFile": "",
          "CertKey": "",
          "AuthAudience": "{{ .IDP_CLIENT_ID }}",
          "AuthIssuer": "https://auth.ebillet.dk/auth/realms/Ebillet",
          "AuthUserIDClaim": "",
          "AuthKeysLocation": "https://auth.ebillet.dk/auth/realms/Ebillet/protocol/openid-connect/certs",
          "OIDCConfigEndpoint": "https://auth.ebillet.dk/auth/realms/Ebillet/.well-known/openid-configuration",
          "IdpSignKeyRefreshEnabled": false
        },
        "IdpManagerConfig": {
          "ManagerType": "keycloak",
          "ClientConfig": {
            "Issuer": "https://auth.ebillet.dk/auth/realms/Ebillet/.well-known/openid-configuration",
            "TokenEndpoint": "https://auth.ebillet.dk/auth/realms/Ebillet/protocol/openid-connect/token",
            "ClientID": "{{ .IDP_CLIENT_MGMT_ID }}",
            "ClientSecret": "{{ .IDP_CLIENT_MGMT_SECRET }}",
            "GrantType": "client_credentials"
          },
          "ExtraConfig": {
            "Password": "{{ .IDP_SERVICE_ACCOUNT_PASSWORD }}",
            "Username": "{{ .IDP_SERVICE_ACCOUNT_USER }}",
            "AdminEndpoint": "https://auth.ebillet.dk/auth/admin/realms/Ebillet"
          },
          "KeycloakClientCredentials": null
        },
        "DeviceAuthorizationFlow": {
          "Provider": "hosted",
          "ProviderConfig": {
            "ClientID": "{{ .IDP_CLIENT_ID }}",
            "ClientSecret": "",
            "Domain": "auth.ebillet.dk",
            "Audience": "{{ .IDP_CLIENT_ID }}",
            "TokenEndpoint": "https://auth.ebillet.dk/auth/realms/Ebillet/protocol/openid-connect/token",
            "DeviceAuthEndpoint": "https://auth.ebillet.dk/auth/realms/Ebillet/protocol/openid-connect/auth/device",
            "AuthorizationEndpoint": "",
            "Scope": "openid",
            "UseIDToken": false,
            "RedirectURLs": null
          }
        },
        "PKCEAuthorizationFlow": {
          "ProviderConfig": {
            "ClientID": "{{ .IDP_CLIENT_ID }}",
            "ClientSecret": "",
            "Domain": "auth.ebillet.dk",
            "Audience": "{{ .IDP_CLIENT_ID }}",
            "TokenEndpoint": "https://auth.ebillet.dk/auth/realms/Ebillet/protocol/openid-connect/token",
            "DeviceAuthEndpoint": "",
            "AuthorizationEndpoint": "",
            "Scope": "openid profile email offline_access netbird-vpn-api",
            "UseIDToken": false,
            "RedirectURLs": null
          }
        },
        "StoreConfig": {
          "Engine": "postgres"
        },
        "ReverseProxy": {
          "TrustedHTTPProxies": null,
          "TrustedHTTPProxiesCount": 0,
          "TrustedPeers": null
        }
      }

    podCommand:
      args:
        - --port=80
        - --log-file=console
        - --log-level=debug
        - --disable-anonymous-metrics=false
        - --single-account-mode-domain=vpn2.ebillet.dk
        - --dns-domain=netbird.selfhosted

    # ingressGrpc:
    #   tls:
    #     - hosts:
    #         - vpn2.ebillet.dk
    #       secretName: vpn2.ebillet.dk
    #   hosts:
    #     - host: vpn2.ebillet.dk
    #       paths:
    #         - path: /management
    #           pathType: ImplementationSpecific
    #
    # ingress:
    #   tls:
    #     - hosts:
    #         - vpn2.ebillet.dk
    #       secretName: vpn2.ebillet.dk
    #   hosts:
    #     - host: vpn2.ebillet.dk
    #       paths:
    #         - path: /api
    #           pathType: ImplementationSpecific

  signal:
    # ingress:
    #   tls:
    #     - hosts:
    #         - vpn2.ebillet.dk
    #       secretName: vpn2.ebillet.dk
    #   hosts:
    #     - host: vpn2.ebillet.dk
    #       paths:
    #         - path: /signalexchange
    #           pathType: ImplementationSpecific

  relay:
    env:
      NB_LOG_LEVEL: info
      NB_LISTEN_ADDRESS: ":33080"
      NB_EXPOSED_ADDRESS: rels://vpn2.ebillet.dk:443/relay
    # ingress:
    #   tls:
    #     - hosts:
    #         - vpn2.ebillet.dk
    #       secretName: vpn2.ebillet.dk
    #   hosts:
    #     - host: vpn2.ebillet.dk
    #       paths:
    #         - path: /relay
    #           pathType: ImplementationSpecific

  dashboard:
    enabled: true
    env:
      # Endpoints
      NETBIRD_MGMT_API_ENDPOINT: https://vpn2.ebillet.dk:443
      NETBIRD_MGMT_GRPC_API_ENDPOINT: https://vpn2.ebillet.dk:443
      # OIDC
      AUTH_AUTHORITY: https://auth.ebillet.dk/auth/realms/Ebillet
    # ingress:
    #   tls:
    #     - hosts:
    #         - vpn2.ebillet.dk
    #       secretName: vpn2.ebillet.dk
    #   hosts:
    #     - host: vpn2.ebillet.dk
    #       paths:
    #         - path: /
    #           pathType: ImplementationSpecific

coturn:
  coturn:
    realm: "turn.vpn2.ebillet.dk"
    auth:
      existingSecret: netbird
      secretKeys:
        username: turnServerUser
        password: turnServerPassword

externalDatabases:
  netbird:
    storageClass: openebs-hostpath
